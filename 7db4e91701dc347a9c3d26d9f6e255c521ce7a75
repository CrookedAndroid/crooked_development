{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4e8f21cc_6f22ee5f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1807569
      },
      "writtenOn": "2024-10-15T09:43:54Z",
      "side": 1,
      "message": "I don\u0027t like that setting `generate_rulesmk` modifies `Android.bp`. It is currently possible for ``generate_rulesmk` to be true when there is no `Android.bp`, only a `rules.mk`.",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c8d1b4bf_425c6d63",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1903830
      },
      "writtenOn": "2024-10-15T15:17:12Z",
      "side": 1,
      "message": "I\u0027m confused. I thought you were going to add a single dirgroup to the top-level Android.bp.\n\nIt seems odd and intrusive to do this for a large number of crates for a single purpose.\n\nI don\u0027t understand what problem you are trying to solve here.",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "447b8edb_a0c18117",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T05:02:01Z",
      "side": 1,
      "message": "This CL is needed to describe dependency of Trusty build in soong build system. In short, we\u0027d like to build Trusty with Android\u0027s build system for AVF. Trusty build would be invoked inside the `nsjail` by `genrule`, and `dirgroup` will be used to specify mount dirs. (see: go/trusty-with-soong-dd for full context)\n\nWithout this CL, Trusty build will fail because src isn\u0027t specified. In other words, `Android.bp` should have `dirgroup` wherever `rules.mk` exists.",
      "parentUuid": "4e8f21cc_6f22ee5f",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c24c45e8_fccc5eeb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T05:02:01Z",
      "side": 1,
      "message": "This CL helps build Trusty as a part of Android soong build, to include it for launching keymint VM via AVF.\n\nHere\u0027s the big picture (i.e. summary of go/trusty-with-soong-dd)\n\n- Trusty will be built with soong for AVF for running on the VM\n  - Trusty running on the TEE will remain the same. (i.e. rules.mk is for TEE, Android.bp is for AVF)\n- Trusty build system will be invoked directly via `genrule` but with `nsjail`.\n  - `nsjail` is the process isolation tool that limits the file access to the mounted directories.\n  - Added new property `use_nsjail` for it.\n- To describe dependencies (`srcs` property), `dirgroups` is added to describe which directory to mount.\n\n--\u003e this CL helps to generate `Android.bp` that\u0027s sufficient to read relevant `rules.mk`. We\u0027d like to have one `dirgroup` whereever `rules.mk` exists instead of having a large `Android.bp` that includes all crates in its subdirectories. It helps to minimize dependencies and unnecessary rebuild.\n\nFeel free to tell me if you have more questions/feedback/comments on here.",
      "parentUuid": "c8d1b4bf_425c6d63",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fce6e9de_49618fc7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1903830
      },
      "writtenOn": "2024-10-16T15:23:43Z",
      "side": 1,
      "message": "Thanks for the explanation. Why can\u0027t you just mount all of external/rust/android-crates-io/crates?",
      "parentUuid": "c24c45e8_fccc5eeb",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aeda1617_87d9a35f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T15:32:17Z",
      "side": 1,
      "message": "Build team wanted to minimize dependencies and Trusty doesn\u0027t use all of the `external/rust/android-crates-io`. Build team approved `dirgroup` just to limit # of parameters of `nsjail`, but wanted to be more explicit about dependencies in detail.",
      "parentUuid": "fce6e9de_49618fc7",
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "151237e6_9b93596a",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1807569
      },
      "writtenOn": "2024-10-15T09:43:54Z",
      "side": 1,
      "message": "When `generate_rulesmk` is true, the user expects `rules.mk` to be generated but they do not expect `Android.bp` to be modified unless `generate_androidbp` is true.\n\nI think this creates potential for confusion. Have you considered other solutions, such as adding a third flag `generate_androidbp_for_rulesmk` (I\u0027m sure you can think of a better name)?",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d69f93b_edc90005",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T05:02:01Z",
      "side": 1,
      "message": "I haven\u0027t considered other option. If there\u0027s a `rules.mk`, then there must be a `dirgroup` in `Android.bp`. Otherwise building trusty with genrule will fail due to the missing dependencies.\n\nI left more detail in other places. Feel free to tell me if you have more comments/questions/feedbacks/...",
      "parentUuid": "151237e6_9b93596a",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ab1edc5_299bcb21",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1807569
      },
      "writtenOn": "2024-10-16T10:30:10Z",
      "side": 1,
      "message": "My worry is that you are silently changing the semantics of an existing flag. Some crates have a variant where `generate_rulesmk` is true and `generate_androidbp` is false. See `cargo_embargo.json` for `zerocopy` for an example.\n\nIn this CL, the former flag now implies the latter so `Android.bp` is modified even if `cargo_embargo.json` sets `generate_androidbp` to false. Shouldn\u0027t `cargo_embargo` emit an error or a warning in that case?",
      "parentUuid": "9d69f93b_edc90005",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bd8ca338_2d629695",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T11:59:38Z",
      "side": 1,
      "message": "Strictly speaking, `generate_androidbp` means that \u0027generates soong build rule for Rust crate to be used by other soong module\u0027. I can change the comment of `generate_androidbp` instead. Tell me if you prefer so.\n\nGiven that we\u0027ll build Trusty with `genrule` as well, if `rules.mk` is created (i.e. Trusty will use it), `dirgroup` __MUST__ be created inside the `Android.bp`. Otherwise Trusty build will fail. In other words, if `generate_rulesmk\u003dtrue` doesn\u0027t touch `Android.bp`, then it\u0027s bug of `cargo_embargo` because it doesn\u0027t create build rules that Trusty requires.",
      "parentUuid": "1ab1edc5_299bcb21",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8dee812e_f08e9fef",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T15:32:17Z",
      "side": 1,
      "message": "Changed the help message of `generate_androidbp`. Parameter name doesn\u0027t match exactly with the behavior, but let me keep it as-is for compatibility reason.",
      "parentUuid": "bd8ca338_2d629695",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ad946fd7_42f2838d",
        "filename": "tools/cargo_embargo/src/config.rs",
        "patchSetId": 2
      },
      "lineNbr": 331,
      "author": {
        "id": 1944400
      },
      "writtenOn": "2024-10-16T16:47:23Z",
      "side": 1,
      "message": "\u003e Some crates have a variant where `generate_rulesmk` is true and `generate_androidbp` is false. See `cargo_embargo.json` for `zerocopy` for an example.\n\nFortunately, `zerocopy` only has `generate_androidbp \u003d false` for one variant. `cargo_embargo` is still responsible for generating its `Android.bp` file, so this shouldn\u0027t cause a problem.\n\nIf there is some user that only wants `cargo_embargo` to generate a `rules.mk` and has a handwritten `Android.bp` file in the same dir, then this change is going to result in that `Android.bp` being clobbered. That sounds like a strange setup to me, so probably fine to ignore until it is a real problem.",
      "parentUuid": "8dee812e_f08e9fef",
      "range": {
        "startLine": 331,
        "startChar": 4,
        "endLine": 331,
        "endChar": 97
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d0b27e65_0a683c9b",
        "filename": "tools/cargo_embargo/src/main.rs",
        "patchSetId": 2
      },
      "lineNbr": 907,
      "author": {
        "id": 1807569
      },
      "writtenOn": "2024-10-15T09:43:54Z",
      "side": 1,
      "message": "does this string mirror the directory organization where `$CRATE` is found under `external/rust/crates/$CRATE`? If so, how do you plan to deal with the switch to the crate monorepo?",
      "range": {
        "startLine": 907,
        "startChar": 33,
        "endLine": 907,
        "endChar": 70
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fe4ceffe_911ad288",
        "filename": "tools/cargo_embargo/src/main.rs",
        "patchSetId": 2
      },
      "lineNbr": 907,
      "author": {
        "id": 1019013
      },
      "writtenOn": "2024-10-16T05:02:01Z",
      "side": 1,
      "message": "This doesn\u0027t need to mirror the directory path although I name it based on the existing directory path. We can keep the name as-is regardless of the monorepo.",
      "parentUuid": "d0b27e65_0a683c9b",
      "range": {
        "startLine": 907,
        "startChar": 33,
        "endLine": 907,
        "endChar": 70
      },
      "revId": "7db4e91701dc347a9c3d26d9f6e255c521ce7a75",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}